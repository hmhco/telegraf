package aurora

import (
	"encoding/json"
	"net/http"
	"net/http/httptest"
	"os"
	"testing"

	"github.com/influxdata/telegraf/testutil"
	"github.com/stretchr/testify/assert"
)

var rawMetrics map[string]interface{}
var auroraTestServer *httptest.Server

func generateMetrics() {
	rawMetrics = map[string]interface{}{"sla_cluster_mtta_ms": 0.0, "sla_role/prod/app_job_uptime_90.00_sec": 219797.8065, "sla_hmheng-content-pipeline/staging1/content-kafka_mtta_ms": 0.0, "sla_role/prod/app1_mtta_ms": 0.0, "sla_role/prod/app2_mtta_ms": 0.0, "sla_role/prod/app3_mtta_ms": 0.0, "sla_role/prod/app4_mttr_ms": 0.0, "sla_role/prod/app1_platform_uptime_percent": 100.0, "sla_role/prod/app2_platform_uptime_percent": 100.0, "sla_role/test/app3_mttr_ms": 0.0, "sla_role/staging999/app4_job_uptime_50.00_sec": 3153786.1425, "sla_role/devel/app2_job_uptime_99.00_sec": 3305389.47114, "sla_role/staging1/app3_mttr_ms": 0.0, "scheduler_thrift_getJobSummary_nanos_total": 41662503, "scheduler_thrift_getConfigSummary_events_per_sec": 0.0,"empty_slots_dedicated_revocable_small":0, "mybatis.create_tables_nanos_per_event":0.0, "CronBatchWorker_items_processed":0, "task_store_RUNNING":0, "mybatis.org.apache.aurora.scheduler.storage.db.JobUpdateDetailsMapper.selectAllDetails_nanos_total":194622333, "preemptor_slot_search_attempts_for_non_prod":0, "scheduler_resource_offers":46, "scheduler_log_snapshot_persist_events_per_sec":0.0, "build.version":"0.17.0-SNAPSHOT", "jvm_prop_java.endorsed.dirs":"/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/endorsed", "mybatis.org.apache.aurora.scheduler.storage.db.MigrationMapper.saveDowngradeScript_nanos_total":15122109, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.AttributeMapper_size":2, "attribute_store_fetch_all_events":4, "lock_store_fetch_locks_nanos_total":5791901, "mybatis.create_tables_nanos_total_per_sec":0.0, "jvm_memory_non_heap_mb_committed":71, "jvm_prop_java.specification.name":"Java Platform API Specification", "mybatis.org.apache.aurora.scheduler.storage.db.AttributeMapper.selectAll_events_per_sec":0.0, "jvm_prop_user.name":"root", "db_storage_mybatis_connection_pool_active_connections":0, "db_storage_read_operation_nanos_total_per_sec":0.0, "empty_slots_dedicated_large":0, "task_throttle_events_per_sec":0.0, "CronBatchWorker_batches_processed":0, "scheduler_log_native_append_nanos_per_event":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.TaskConfigMapper.selectAllRowIds_nanos_per_event":0.0, "mybatis.create_tables_nanos_total":325071911, "mybatis.org.apache.aurora.scheduler.storage.db.JobUpdateDetailsMapper.selectJobKeysForPruning_events":16, "TaskGroupBatchWorker_batch_locked_nanos_per_event":0.0, "log_manager_deflate_nanos_per_event":0.0, "log_manager_append_nanos_per_event":0.0, "scheduler_lifecycle_PREPARING_STORAGE":0, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.AttributeMapper_miss_count":7, "attribute_store_save_events_per_sec":0.0, "jvm_prop_path.separator":":", "resources_quota_consumed_disk_mb":0, "job_update_store_prune_history_nanos_per_event":0.0, "snapshot_reduplicate_events_per_sec":0.0, "empty_slots_revocable_medium":0, "jvm_prop_java.vm.specification.version":"1.8", "scheduler_store_fetch_framework_id_events_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.JobKeyMapper.selectAllRowIds_events":3, "status_updates_queue_size":0, "preemptor_task_processor_runs":251, "log_entry_serialize_events_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.JobUpdateDetailsMapper.selectAllDetails_events_per_sec":0.0, "TaskEventBatchWorker_batch_locked_nanos_total_per_sec":0.0, "preemption_slot_cache_size":0, "system_env_PWD":"/home/vagrant/aurora/dist/install/aurora-scheduler", "jvm_memory_mb_total":228, "jvm_prop_java.version":"1.8.0_111", "jvm_prop_user.dir":"/home/vagrant/aurora/dist/install/aurora-scheduler", "jvm_prop_os.arch":"amd64", "mybatis.org.apache.aurora.scheduler.storage.db.QuotaMapper.selectAll_events_per_sec":0.0, "jvm_memory_heap_mb_committed":228, "mybatis.org.apache.aurora.scheduler.storage.db.MigrationMapper.bootstrapChangelog_nanos_per_event":0.0, "empty_slots_revocable_large":0, "TaskGroupBatchWorker_items_processed":0, "http_200_responses_nanos_per_event":0.0, "job_update_store_fetch_details_list_events_per_sec":0.0, "jvm_memory_max_mb":670, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.TaskConfigMapper_clear_count":0, "attribute_store_fetch_one_events_per_sec":0.0, "log_manager_append_nanos_total_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.AttributeMapper.select_nanos_total":10941855, "empty_slots_small":1, "TaskGroupBatchWorker_batch_unlocked_events":0, "jvm_prop_java.vm.specification.vendor":"Oracle Corporation", "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.TaskMapper_size":3, "scheduler_log_entries_written":5, "mybatis.org.apache.aurora.scheduler.storage.db.JobUpdateDetailsMapper.selectJobKeysForPruning_events_per_sec":0.0, "http_200_responses_nanos_total":71741510, "variable_scrape_events_per_sec":0.9979629988432441, "task_store_DRAINING":0, "http_200_responses_events":2, "reservation_cache_size":0, "empty_slots_xlarge":0, "resources_total_consumed_ram_mb":0, "TaskGroupBatchWorker_batch_locked_nanos_total":0, "attribute_store_fetch_all_nanos_total":3517250, "shiro_authorization_failures":0, "empty_slots_revocable_xlarge":0, "mybatis.org.apache.aurora.scheduler.storage.db.TaskConfigMapper.selectAllRowIds_events_per_sec":0.0, "scheduler_log_native_read_nanos_total_per_sec":0.0, "jvm_memory_free_mb":63, "log_manager_deflate_events":4, "db_storage_fetch_tasks_events_per_sec":0.0, "scheduler_log_recover_events_per_sec":0.0, "scheduler_store_save_framework_id_nanos_total_per_sec":0.0, "lock_store_fetch_locks_nanos_total_per_sec":0.0, "jvm_prop_sun.boot.library.path":"/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/amd64", "log_manager_append_events":5, "scheduler_log_native_read_timeouts":0, "scheduler_log_native_read_nanos_total":3709764, "job_update_store_prune_history_events_per_sec":0.0, "CronBatchWorker_batch_locked_nanos_total_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.JobUpdateDetailsMapper.selectDetailsList_events":1, "sla_stats_computation_events_per_sec":0.0, "jvm_prop_java.awt.printerjob":"sun.print.PSPrinterJob", "mybatis.org.apache.aurora.scheduler.storage.db.TaskConfigMapper.selectAllRowIds_events":3, "mybatis.org.apache.aurora.scheduler.storage.db.EnumValueMapper.addEnumValue_nanos_per_event":0.0, "schedule_attempts_failed":0, "mybatis.org.apache.aurora.scheduler.storage.db.AttributeMapper.selectAll_nanos_total":2999886, "jvm_prop_java.class.version":"52.0", "scheduled_task_penalty_events":0, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.TaskMapper_miss_rate":0.03409090909090909, "attribute_store_save_nanos_total_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.FrameworkIdMapper.select_nanos_per_event":0.0, "scheduler_store_fetch_framework_id_nanos_per_event":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.MigrationMapper.selectAll_events_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.AttributeMapper.select_nanos_total_per_sec":0.0, "scheduler_log_native_append_events_per_sec":0.0, "scheduler_store_save_framework_id_events_per_sec":0.0, "jvm_prop_file.encoding":"ANSI_X3.4-1968", "TaskEventBatchWorker_batch_unlocked_events":0, "scheduler_log_snapshot_nanos_total_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.JobUpdateDetailsMapper.selectDetailsList_nanos_per_event":0.0, "job_update_store_fetch_details_list_nanos_per_event":0.0, "preemptor_tasks_preempted_non_prod":0, "CronBatchWorker_batch_unlocked_events":0, "mybatis.org.apache.aurora.scheduler.storage.db.AttributeMapper.select_events_per_sec":0.0, "CronBatchWorker_queue_size":0, "scheduler_log_snapshot_events_per_sec":0.0, "jvm_prop_os.version":"3.13.0-100-generic", "db_storage_read_operation_events_per_sec":0.0, "task_store_INIT":0, "attribute_store_save_events":46, "jvm_prop_java.specification.version":"1.8", "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.TaskConfigMapper_hit_count":0, "mybatis.org.apache.aurora.scheduler.storage.db.MigrationMapper.saveDowngradeScript_events":9, "scheduler_log_snapshot_persist_nanos_per_event":0.0, "preemptor_slot_search_failed_for_non_prod":0, "task_throttle_ms_total_per_sec":0.0, "db_storage_fetch_tasks_events":264, "scheduler_log_snapshot_nanos_total":333636518, "TaskGroupBatchWorker_queue_size":0, "job_update_store_fetch_all_details_events_per_sec":0.0, "scheduled_task_penalty_events_per_sec":0.0, "jvm_prop_java.vm.specification.name":"Java Virtual Machine Specification", "quota_store_fetch_quotas_events_per_sec":0.0, "quota_store_fetch_quotas_nanos_per_event":0.0, "scheduler_backup_failed":0, "mybatis.org.apache.aurora.scheduler.storage.db.JobKeyMapper.selectAllRowIds_nanos_total":1274429, "jvm_prop_java.vm.info":"mixed mode", "scheduler_log_snapshots":4, "preemptor_slot_search_successful_for_non_prod":0, "mybatis.org.apache.aurora.scheduler.storage.db.TaskConfigMapper.selectAllRowIds_nanos_total":2198881, "scheduler_lifecycle_IDLE":0, "CronBatchWorker_batch_unlocked_events_per_sec":0.0, "snapshot_create_nanos_per_event":0.0, "snapshot_reduplicate_events":1, "system_env_UPSTART_JOB":"aurora-scheduler", "scheduler_log_native_native_entries_skipped":1, "log_entry_serialize_events":5, "http_200_responses_nanos_total_per_sec":0.0, "job_update_store_fetch_all_details_events":4, "task_store_KILLING":0, "TaskGroupBatchWorker_batch_unlocked_events_per_sec":0.0, "attribute_store_save_nanos_per_event":0.0, "jvm_prop_sun.arch.data.model":"64", "scheduler_log_native_append_timeouts":0, "jvm_prop_line.separator":"\n", "jvm_prop_file.separator":"/", "empty_slots_revocable_small":0, "jvm_uptime_secs":15032, "log_storage_write_lock_wait_events_per_sec":0.0, "variable_scrape_events":15029, "scheduler_log_native_append_events":6, "db_storage_fetch_tasks_nanos_per_event":0.0, "jvm_prop_java.vm.version":"25.111-b14", "log_manager_append_nanos_total":17288469, "scheduler_log_snapshot_nanos_per_event":0.0, "system_env_GLOG_v":"0", "job_update_store_fetch_details_list_events":1, "jvm_time_ms":1498591251394, "db_storage_cron_fetch_jobs_events_per_sec":0.0, "scheduler_log_snapshot_persist_events":4, "task_store_STARTING":0, "jvm_prop_file.encoding.pkg":"sun.io", "empty_slots_dedicated_revocable_xlarge":0, "offer_accept_races":0, "mybatis.org.apache.aurora.scheduler.storage.db.FrameworkIdMapper.insert_nanos_per_event":0.0, "attribute_store_fetch_one_nanos_total_per_sec":0.0, "db_storage_mybatis_connection_pool_connections_had_to_wait":0, "system_env_PATH":"/usr/local/sbin:/usr/local/bin:/usr/bin:/usr/sbin:/sbin:/bin", "mybatis.org.apache.aurora.scheduler.storage.db.MigrationMapper.selectAll_nanos_total_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.TaskMapper.select_events":264, "jvm_gc_PS_MarkSweep_collection_time_ms":262, "system_env_OLDPWD":"/home/vagrant/aurora/dist/install/aurora-scheduler", "db_storage_mybatis_connection_pool_bad_connections":0, "jvm_gc_collection_count":19, "uncaught_exceptions":0, "TaskEventBatchWorker_batch_locked_nanos_per_event":0.0, "log_storage_write_lock_wait_ns_total_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.CronJobMapper.selectAll_nanos_total_per_sec":0.0, "scheduler_log_bad_frames_read":0, "lock_store_fetch_locks_nanos_per_event":0.0, "empty_slots_dedicated_xlarge":0, "scheduler_log_native_truncate_failures":0, "mybatis.create_tables_events_per_sec":0.0, "CronBatchWorker_batch_locked_nanos_total":0, "jvm_class_loaded_count":8880, "scheduler_log_native_truncate_nanos_total":7325070, "log_manager_snapshot_nanos_total":27037324, "scheduler_resource_offers_nanos_per_event":0.0, "task_store_FAILED":0, "scheduled_task_penalty_ms_total_per_sec":0.0, "resources_quota_consumed_ram_mb":0, "TaskGroupBatchWorker_batch_unlocked_nanos_total":0, "jvm_threads_started":118, "snapshot_deduplicate_nanos_per_event":0.0, "jvm_prop_java.ext.dirs":"/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/ext:/usr/java/packages/lib/ext", "scheduler_log_native_read_failures":0, "lock_store_fetch_locks_events_per_sec":0.0, "scheduler_resource_offers_events":46, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.AttributeMapper_hit_count":89, "db_storage_write_operation_events":82, "task_throttle_events":0, "log_storage_write_lock_wait_ns_per_event":0.0, "system_load_avg":0.03, "preemptor_slot_search_attempts_for_prod":0, "scheduler_log_entries_read":2, "jvm_prop_java.awt.graphicsenv":"sun.awt.X11GraphicsEnvironment", "system_env_TERM":"linux", "preemptor_slot_search_successful_for_prod":0, "snapshot_deduplicate_nanos_total_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.FrameworkIdMapper.select_nanos_total":5998306, "attribute_store_fetch_all_nanos_total_per_sec":0.0, "scheduler_backup_success":4, "mybatis.org.apache.aurora.scheduler.storage.db.CronJobMapper.selectAll_nanos_total":14897718, "scheduler_resource_offers_nanos_total":21376584, "attribute_store_fetch_one_nanos_total":17147539, "scheduler_store_fetch_framework_id_nanos_total":8054983, "preemptor_tasks_preempted_prod":0, "db_storage_fetch_tasks_nanos_total":356648756, "db_storage_cron_fetch_jobs_nanos_total":16480402, "jvm_prop_java.runtime.version":"1.8.0_111-8u111-b14-3~14.04.1-b14", "mybatis.org.apache.aurora.scheduler.storage.db.FrameworkIdMapper.insert_events_per_sec":0.0, "jvm_available_processors":2, "task_throttle_ms_total":0, "attribute_store_fetch_all_nanos_per_event":0.0, "schedule_attempts_fired":0, "system_env_UPSTART_INSTANCE":"", "assigner_launch_failures":0, "task_kill_retries":0, "snapshot_create_events":4, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.TaskMapper_hit_rate":0.9659090909090909, "TaskGroupBatchWorker_batches_processed":0, "mybatis.org.apache.aurora.scheduler.storage.db.QuotaMapper.selectAll_nanos_total_per_sec":0.0, "empty_slots_dedicated_revocable_large":0, "job_update_store_prune_history_nanos_total":48992963, "scheduler_log_native_truncate_events":4, "TaskEventBatchWorker_items_processed":0, "mybatis.org.apache.aurora.scheduler.storage.db.LockMapper.selectAll_nanos_per_event":0.0, "preemptor_slot_validation_successful":0, "jvm_class_total_loaded_count":8914, "mybatis.org.apache.aurora.scheduler.storage.db.EnumValueMapper.addEnumValue_events_per_sec":0.0, "jvm_prop_sun.cpu.isalist":"", "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.TaskMapper_hit_count":255, "snapshot_reduplicate_nanos_total_per_sec":0.0, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.AttributeMapper_hit_rate":0.9270833333333334, "mybatis.org.apache.aurora.scheduler.storage.db.LockMapper.selectAll_events_per_sec":0.0, "event_bus_exceptions":0, "resources_total_consumed_disk_mb":0, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.TaskConfigMapper_miss_count":3, "TaskEventBatchWorker_batch_locked_nanos_total":0, "CronBatchWorker_batch_unlocked_nanos_per_event":0.0, "resources_dedicated_consumed_disk_mb":0, "scheduler_log_native_truncate_nanos_per_event":0.0, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.TaskMapper_eviction_count":6, "mybatis.org.apache.aurora.scheduler.storage.db.FrameworkIdMapper.insert_nanos_total_per_sec":0.0, "CronBatchWorker_batch_unlocked_nanos_total_per_sec":0.0, "db_storage_write_operation_events_per_sec":0.0, "delay_executor_queue_size":0, "job_update_delete_errors":0, "system_env_SHLVL":"0", "scheduler_log_native_append_failures":0, "jvm_prop_user.timezone":"Etc/UTC", "mybatis.org.apache.aurora.scheduler.storage.db.TaskMapper.select_nanos_total_per_sec":0.0, "build.date":"Thu 2017-06-22", "mybatis.org.apache.aurora.scheduler.storage.db.LockMapper.selectAll_nanos_total_per_sec":0.0, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.TaskConfigMapper_size":1, "resources_dedicated_consumed_cpu_cores":0, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.AttributeMapper_miss_rate":0.07291666666666667, "db_storage_read_operation_nanos_per_event":0.0, "cron_job_parse_failures":0, "db_storage_write_operation_nanos_total":3225495519, "mybatis.org.apache.aurora.scheduler.storage.db.JobUpdateDetailsMapper.selectJobKeysForPruning_nanos_total_per_sec":0.0, "jvm_prop_os.name":"Linux", "snapshot_apply_events":1, "scheduler_log_snapshot_events":4, "jvm_prop_sun.os.patch.level":"unknown", "mybatis.org.apache.aurora.scheduler.storage.db.JobUpdateDetailsMapper.selectJobKeysForPruning_nanos_per_event":0.0, "TaskEventBatchWorker_batch_locked_events_per_sec":0.0, "db_storage_write_operation_nanos_total_per_sec":0.0, "TaskEventBatchWorker_batch_unlocked_nanos_per_event":0.0, "TaskGroupBatchWorker_batch_locked_nanos_total_per_sec":0.0, "empty_slots_dedicated_revocable_medium":0, "empty_slots_large":0, "jvm_threads_peak":55, "reconciliation_implicit_runs":4, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.TaskMapper_request_count":264, "scheduler_log_native_read_events_per_sec":0.0, "system_env_LIBPROCESS_PORT":"8083", "log_manager_snapshot_nanos_total_per_sec":0.0, "job_update_state_change_errors":0, "job_update_store_prune_history_events":16, "snapshot_apply_nanos_per_event":0.0, "scheduler_resource_offers_nanos_total_per_sec":0.0, "attribute_store_fetch_all_events_per_sec":0.0, "CronBatchWorker_batch_locked_events":0, "snapshot_apply_events_per_sec":0.0, "attribute_store_fetch_one_events":92, "TaskGroupBatchWorker_batch_unlocked_nanos_total_per_sec":0.0, "jvm_prop_user.language":"en", "TaskEventBatchWorker_batch_unlocked_nanos_total":0, "task_store_PREEMPTING":0, "mybatis.org.apache.aurora.scheduler.storage.db.AttributeMapper.selectAll_nanos_per_event":0.0, "resources_total_consumed_cpu_cores":0, "job_update_store_prune_history_nanos_total_per_sec":0.0, "db_storage_cron_fetch_jobs_events":5, "db_storage_mybatis_connection_pool_average_request_time_ms":3, "shiro_bad_requests":0, "jvm_prop_java.runtime.name":"OpenJDK Runtime Environment", "CronBatchWorker_batch_unlocked_nanos_total":0, "jvm_prop_java.class.path":"/vagrant/dist/.hot_resources:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/aurora-0.17.0-SNAPSHOT.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/dependency-cache:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/classes:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/classes:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/dependency-cache:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/classes:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/aurora-api-0.17.0-SNAPSHOT.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/commons-0.17.0-SNAPSHOT.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/commons-args-0.17.0-SNAPSHOT.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/aopalliance-1.0.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/logback-classic-1.1.3.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jsr305-3.0.1.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/guice-3.0.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/guice-assistedinject-3.0.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/protobuf-java-2.6.1.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/h2-1.4.193.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jackson-datatype-protobuf-0.9.3.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jackson-core-2.5.1.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jersey-core-1.19.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jersey-json-1.19.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jersey-server-1.19.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jersey-servlet-1.19.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jersey-guice-1.19.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/javax.inject-1.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/javax.servlet-api-3.1.0.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/stringtemplate-3.2.1.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/curator-client-2.11.1.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/curator-framework-2.11.1.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/curator-recipes-2.11.1.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/mesos-1.0.0.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/httpclient-4.5.2.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/httpcore-4.4.4.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/shiro-guice-1.2.4.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/shiro-web-1.2.4.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/zookeeper-3.4.8.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jetty-rewrite-9.3.11.v20160721.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jetty-server-9.3.11.v20160721.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jetty-servlet-9.3.11.v20160721.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jetty-servlets-9.3.11.v20160721.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/mybatis-3.4.1.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/mybatis-guice-3.7.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/mybatis-migrations-3.2.0.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/quartz-2.2.2.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/forward-1.0.0.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/libthrift-0.9.1.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/gson-2.3.1.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/guava-20.0.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/guice-multibindings-3.0.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/commons-lang-2.6.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/joda-time-2.9.1.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/easymock-3.4.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/junit-4.12.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/logback-core-1.1.3.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/slf4j-api-1.7.7.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/cglib-2.2.1-v20090111.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jackson-annotations-2.4.6.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jackson-databind-2.4.6.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/annotations-3.0.0.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jsr311-api-1.1.1.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jettison-1.1.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jaxb-impl-2.2.3-1.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jackson-core-asl-1.9.2.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jackson-mapper-asl-1.9.2.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jackson-jaxrs-1.9.2.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jackson-xc-1.9.2.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/guice-servlet-3.0.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/antlr-2.7.7.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/commons-logging-1.2.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/commons-codec-1.9.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/shiro-core-1.2.4.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jline-0.9.94.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/netty-3.7.0.Final.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jetty-client-9.3.11.v20160721.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jetty-http-9.3.11.v20160721.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jetty-io-9.3.11.v20160721.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jetty-security-9.3.11.v20160721.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jetty-continuation-9.3.11.v20160721.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jetty-util-9.3.11.v20160721.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/c3p0-0.9.1.1.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/javapoet-1.4.0.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/commons-lang3-3.1.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/objenesis-2.2.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/hamcrest-core-1.3.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/asm-3.1.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/jaxb-api-2.2.2.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/commons-beanutils-1.8.3.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/stax-api-1.0-2.jar:/home/vagrant/aurora/dist/install/aurora-scheduler/lib/activation-1.1.jar", "jvm_prop_sun.io.unicode.encoding":"UnicodeLittle", "mybatis.org.apache.aurora.scheduler.storage.db.JobUpdateDetailsMapper.selectDetailsList_nanos_total":86496916, "system_env_DIST_DIR":"/home/vagrant/aurora/dist", "mybatis.org.apache.aurora.scheduler.storage.db.TaskConfigMapper.selectAllRowIds_nanos_total_per_sec":0.0, "scheduler_driver_kill_failures":0, "attribute_store_save_nanos_total":3280567, "scheduler_log_native_truncate_timeouts":0, "jvm_prop_java.vendor.url":"http://java.oracle.com/", "process_cpu_cores_utilized":0.009979225726884606, "mybatis.org.apache.aurora.scheduler.storage.db.CronJobMapper.selectAll_events_per_sec":0.0, "cron_job_triggers":0, "CronBatchWorker_batch_locked_nanos_per_event":0.0, "system_env_LIBPROCESS_IP":"192.168.33.7", "scheduler_lifecycle_LEADER_AWAITING_REGISTRATION":0, "scheduler_lifecycle_DEAD":0, "mybatis.org.apache.aurora.scheduler.storage.db.QuotaMapper.selectAll_nanos_per_event":0.0, "scheduler_log_recover_events":1, "snapshot_deduplicate_nanos_total":2449548, "snapshot_reduplicate_nanos_total":6368775, "scheduled_task_penalty_ms_per_event":0.0, "sla_stats_computation_nanos_total":354182671, "mybatis.org.apache.aurora.scheduler.storage.db.FrameworkIdMapper.insert_events":1, "scheduler_log_bytes_written":25076, "mybatis.org.apache.aurora.scheduler.storage.db.MigrationMapper.bootstrapChangelog_events":1, "mybatis.org.apache.aurora.scheduler.storage.db.MigrationMapper.bootstrapChangelog_events_per_sec":0.0, "snapshot_reduplicate_nanos_per_event":0.0, "jvm_threads_daemon":37, "jvm_prop_sun.cpu.endian":"little", "snapshot_create_nanos_total_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.EnumValueMapper.addEnumValue_events":45, "jvm_prop_java.vm.vendor":"Oracle Corporation", "cron_job_launch_failures":0, "TaskEventBatchWorker_batch_locked_events":0, "resources_free_pool_consumed_disk_mb":0, "TaskGroupBatchWorker_batch_locked_events":0, "mybatis.org.apache.aurora.scheduler.storage.db.TaskMapper.select_events_per_sec":0.0, "async_tasks_completed":46, "db_storage_mybatis_connection_pool_average_wait_time_ms":0, "TaskEventBatchWorker_batch_unlocked_events_per_sec":0.0, "scheduled_task_penalty_ms_total":0, "task_store_RESTARTING":0, "snapshot_create_nanos_total":290682032, "snapshot_deduplicate_events_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.MigrationMapper.bootstrapChangelog_nanos_total_per_sec":0.0, "db_storage_fetch_tasks_nanos_total_per_sec":0.0, "TaskEventBatchWorker_queue_size":0, "resources_dedicated_consumed_ram_mb":0, "resources_allocated_quota_ram_mb":0, "jvm_prop_java.library.path":"/usr/lib", "db_storage_mybatis_connection_pool_requests":55, "task_throttle_ms_per_event":0.0, "framework_registered":1, "resources_quota_consumed_cpu_cores":0, "scheduler_log_native_read_nanos_per_event":0.0, "jvm_prop_user.home":"/root", "mybatis.org.apache.aurora.scheduler.storage.db.EnumValueMapper.addEnumValue_nanos_total":62089421, "snapshot_apply_nanos_total_per_sec":0.0, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.TaskConfigMapper_hit_rate":0.0, "job_update_recovery_errors":0, "jvm_memory_heap_mb_max":670, "mybatis.org.apache.aurora.scheduler.storage.db.FrameworkIdMapper.select_nanos_total_per_sec":0.0, "jvm_memory_non_heap_mb_max":0, "mybatis.org.apache.aurora.scheduler.storage.db.MigrationMapper.saveDowngradeScript_nanos_per_event":0.0, "resources_free_pool_consumed_cpu_cores":0, "scheduler_store_save_framework_id_nanos_per_event":0.0, "task_store_THROTTLED":0, "log_manager_deflate_nanos_total_per_sec":0.0, "TaskEventBatchWorker_batch_unlocked_nanos_total_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.JobUpdateDetailsMapper.selectJobKeysForPruning_nanos_total":46394790, "mybatis.org.apache.aurora.scheduler.storage.db.AttributeMapper.select_events":92, "mybatis.org.apache.aurora.scheduler.storage.db.MigrationMapper.selectAll_nanos_per_event":0.0, "task_store_LOST":0, "snapshot_create_events_per_sec":0.0, "scheduler_log_native_append_nanos_total":18502610, "job_update_store_fetch_all_details_nanos_total_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.JobUpdateDetailsMapper.selectDetailsList_nanos_total_per_sec":0.0, "scheduler_log_recover_nanos_total":1180131007, "db_storage_read_operation_events":516, "empty_slots_dedicated_small":0, "preemptor_slot_validation_failed":0, "lock_store_fetch_locks_events":4, "process_open_fd_count":137, "mybatis.org.apache.aurora.scheduler.storage.db.QuotaMapper.selectAll_events":8, "CronBatchWorker_last_processed_batch_size":0, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.TaskConfigMapper_request_count":3, "TaskEventBatchWorker_batches_processed":0, "jvm_prop_java.vendor.url.bug":"http://bugreport.sun.com/bugreport/", "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.TaskMapper_miss_count":9, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.AttributeMapper_clear_count":0, "build.time":"2017-06-22 15:09:05 UTC", "mybatis.org.apache.aurora.scheduler.storage.db.FrameworkIdMapper.select_events_per_sec":0.0, "cron_job_misfires":0, "log_manager_snapshot_events_per_sec":0.0, "cron_job_collisions":0, "async_executor_uncaught_exceptions":0, "mybatis.org.apache.aurora.scheduler.storage.db.JobUpdateDetailsMapper.selectAllDetails_events":4, "jvm_prop_sun.jnu.encoding":"ANSI_X3.4-1968", "jvm_prop_java.vendor":"Oracle Corporation", "mybatis.org.apache.aurora.scheduler.storage.db.MigrationMapper.saveDowngradeScript_nanos_total_per_sec":0.0, "process_cpu_time_nanos":78260000000, "scheduler_log_recover_nanos_per_event":0.0, "jvm_threads_active":55, "mybatis.org.apache.aurora.scheduler.storage.db.AttributeMapper.select_nanos_per_event":0.0, "process_max_fd_count":4096, "jvm_input_arguments":"[-Djava.library.path\u003d/usr/lib, -Xdebug, -Xrunjdwp:transport\u003ddt_socket,server\u003dy,suspend\u003dn,address\u003d5005]", "log_entry_serialize_nanos_per_event":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.FrameworkIdMapper.select_events":5, "timed_out_tasks":0, "job_update_store_fetch_details_list_nanos_total_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.MigrationMapper.bootstrapChangelog_nanos_total":657454, "sla_stats_computation_nanos_total_per_sec":0.0, "jvm_gc_collection_time_ms":521, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.TaskConfigMapper_miss_rate":1.0, "jvm_prop_java.vm.name":"OpenJDK 64-Bit Server VM", "mybatis.org.apache.aurora.scheduler.storage.db.AttributeMapper.selectAll_nanos_total_per_sec":0.0, "job_update_store_fetch_all_details_nanos_total":195512681, "jvm_memory_heap_mb_used":164, "jvm_prop_user.country":"US", "mybatis.org.apache.aurora.scheduler.storage.db.JobUpdateDetailsMapper.selectAllDetails_nanos_total_per_sec":0.0, "log_storage_write_lock_wait_ns_total":208507252, "scheduler_store_save_framework_id_events":1, "sla_stats_computation_events":250, "scheduler_store_save_framework_id_nanos_total":2904703, "task_store_PENDING":0, "jvm_prop_java.specification.vendor":"Oracle Corporation", "db_storage_write_operation_nanos_per_event":0.0, "quota_store_fetch_quotas_events":8, "scheduler_log_snapshot_persist_nanos_total_per_sec":0.0, "scheduler_resource_offers_events_per_sec":0.0, "variable_scrape_micros_total_per_sec":1437.066871787205, "log_manager_snapshot_events":4, "log_manager_snapshot_nanos_per_event":0.0, "system_free_physical_memory_mb":1178, "scheduler_lifecycle_STORAGE_PREPARED":0, "system_free_swap_mb":0, "mybatis.org.apache.aurora.scheduler.storage.db.JobKeyMapper.selectAllRowIds_nanos_total_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.TaskMapper.select_nanos_total":327437710, "jvm_prop_sun.java.launcher":"SUN_STANDARD", "TaskGroupBatchWorker_last_processed_batch_size":0, "jvm_prop_java.home":"/usr/lib/jvm/java-8-openjdk-amd64/jre", "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.TaskMapper_clear_count":0, "cron_job_concurrent_runs":0, "log_entry_serialize_nanos_total":3143170, "CronBatchWorker_batch_locked_events_per_sec":0.0, "log_storage_write_lock_wait_events":77, "task_store_KILLED":0, "job_update_store_fetch_details_list_nanos_total":91347668, "db_storage_mybatis_connection_pool_average_checkout_time_ms":33, "task_store_ASSIGNED":0, "timeout_queue_size":1, "mybatis.org.apache.aurora.scheduler.storage.db.LockMapper.selectAll_events":4, "mybatis.org.apache.aurora.scheduler.storage.db.JobUpdateDetailsMapper.selectAllDetails_nanos_per_event":0.0, "log_manager_append_events_per_sec":0.0, "attribute_store_fetch_one_nanos_per_event":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.QuotaMapper.selectAll_nanos_total":4468188, "system_env_JAVA_OPTS":"-Djava.library.path\u003d/usr/lib -Xdebug -Xrunjdwp:transport\u003ddt_socket,server\u003dy,suspend\u003dn,address\u003d5005 ", "snapshot_apply_nanos_total":1121356608, "mybatis.org.apache.aurora.scheduler.storage.db.CronJobMapper.selectAll_nanos_per_event":0.0, "resources_free_pool_consumed_ram_mb":0, "db_storage_cron_fetch_jobs_nanos_total_per_sec":0.0, "empty_slots_medium":0, "scheduler_log_native_truncate_nanos_total_per_sec":0.0, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.AttributeMapper_request_count":96, "variable_scrape_micros_total":12776338, "mybatis.org.apache.aurora.scheduler.storage.db.MigrationMapper.saveDowngradeScript_events_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.EnumValueMapper.addEnumValue_nanos_total_per_sec":0.0, "http_200_responses_events_per_sec":0.0, "scheduler_log_bytes_read":6255, "job_update_store_fetch_all_details_nanos_per_event":0.0, "jvm_gc_PS_Scavenge_collection_count":16, "scheduler_log_deflated_entries_read":1, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.TaskConfigMapper_eviction_count":2, "sla_stats_computation_nanos_per_event":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.MigrationMapper.selectAll_events":1, "empty_slots_dedicated_medium":0, "quota_store_fetch_quotas_nanos_total_per_sec":0.0, "log_manager_deflate_nanos_total":4316157, "scheduler_log_un_snapshotted_transactions":0, "jvm_prop_awt.toolkit":"sun.awt.X11.XToolkit", "jvm_prop_sun.boot.class.path":"/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/resources.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/rt.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/sunrsasign.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jsse.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jce.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/charsets.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/lib/jfr.jar:/usr/lib/jvm/java-8-openjdk-amd64/jre/classes", "db_storage_mybatis_connection_pool_claimed_overdue_connections":0, "scheduler_lifecycle_ACTIVE":1, "preemptor_missing_attributes":0, "resources_allocated_quota_disk_mb":0, "preemptor_slot_search_failed_for_prod":0, "mybatis.org.apache.aurora.scheduler.storage.db.FrameworkIdMapper.insert_nanos_total":2719347, "scheduler_store_fetch_framework_id_nanos_total_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.MigrationMapper.selectAll_nanos_total":29221188, "jvm_prop_sun.management.compiler":"HotSpot 64-Bit Tiered Compilers", "cron_jobs_loaded":1, "scheduler_log_native_read_events":3, "scheduler_log_native_truncate_events_per_sec":0.0, "db_storage_mybatis_connection_pool_idle_connections":2, "scheduler_log_recover_nanos_total_per_sec":0.0, "scheduler_store_fetch_framework_id_events":5, "scheduler_log_native_append_nanos_total_per_sec":0.0, "TaskGroupBatchWorker_batch_unlocked_nanos_per_event":0.0, "db_storage_mybatis_connection_pool_average_overdue_checkout_time_ms":0, "mybatis.org.apache.aurora.scheduler.storage.db.LockMapper.selectAll_nanos_total":2868597, "jvm_gc_PS_Scavenge_collection_time_ms":259, "resources_allocated_quota_cpu_cores":0, "mybatis.org.apache.aurora.scheduler.storage.db.CronJobMapper.selectAll_events":5, "mybatis.org.apache.aurora.scheduler.storage.db.JobKeyMapper.selectAllRowIds_events_per_sec":0.0, "reconciliation_explicit_runs":5, "task_store_FINISHED":0, "quartz_scheduler_running":1, "jvm_class_unloaded_count":34, "mybatis.org.apache.aurora.scheduler.storage.db.JobUpdateDetailsMapper.selectDetailsList_events_per_sec":0.0, "db_storage_mybatis_cache_org.apache.aurora.scheduler.storage.db.AttributeMapper_eviction_count":3, "jvm_prop_java.io.tmpdir":"/tmp", "snapshot_deduplicate_events":4, "log_manager_deflate_events_per_sec":0.0, "schedule_attempts_no_match":0, "db_storage_read_operation_nanos_total":420255856, "log_entry_serialize_nanos_total_per_sec":0.0, "quota_store_fetch_quotas_nanos_total":50275589, "scheduler_log_snapshot_persist_nanos_total":27250636, "jvm_prop_sun.java.command":"org.apache.aurora.scheduler.app.SchedulerMain -cluster_name\u003ddevcluster -hostname\u003daurora.local -http_port\u003d8081 -native_log_quorum_size\u003d1 -zk_endpoints\u003dlocalhost:2181 -mesos_master_address\u003dzk://localhost:2181/mesos -serverset_path\u003d/aurora/scheduler -native_log_zk_group_path\u003d/aurora/replicated-log -native_log_file_path\u003d/var/db/aurora -backup_dir\u003d/var/lib/aurora/backups -thermos_executor_path\u003d/home/vagrant/aurora/dist/thermos_executor.pex -global_container_mounts\u003d/home/vagrant/aurora/examples/vagrant/config:/home/vagrant/aurora/examples/vagrant/config:ro -thermos_executor_flags\u003d--announcer-ensemble localhost:2181 --announcer-zookeeper-auth-config /home/vagrant/aurora/examples/vagrant/config/announcer-auth.json --mesos-containerizer-path\u003d/usr/libexec/mesos/mesos-containerizer -allowed_container_types\u003dMESOS,DOCKER -http_authentication_mechanism\u003dBASIC -use_beta_db_task_store\u003dtrue -shiro_ini_path\u003detc/shiro.example.ini -enable_h2_console\u003dtrue -tier_config\u003d/home/vagrant/aurora/src/main/resources/org/apache/aurora/scheduler/tiers.json -mesos_role\u003daurora-role -populate_discovery_info\u003dtrue -receive_revocable_resources\u003dtrue -enable_revocable_ram\u003dtrue -allow_gpu_resource\u003dtrue -offer_filter_duration\u003d0secs", "jvm_memory_non_heap_mb_used":69, "TaskGroupBatchWorker_batch_locked_events_per_sec":0.0, "mybatis.org.apache.aurora.scheduler.storage.db.AttributeMapper.selectAll_events":4, "mybatis.create_tables_events":1, "variable_scrape_micros_per_event":1440.0001537661553, "jvm_gc_PS_MarkSweep_collection_count":3, "TaskEventBatchWorker_last_processed_batch_size":0, "mybatis.org.apache.aurora.scheduler.storage.db.TaskMapper.select_nanos_per_event":0.0, "db_storage_cron_fetch_jobs_nanos_per_event":0.0, "outstanding_offers":1, "mybatis.org.apache.aurora.scheduler.storage.db.JobKeyMapper.selectAllRowIds_nanos_per_event":0.0}
}

func TestMain(m *testing.M) {
	generateMetrics()
	masterRouter := http.NewServeMux()
	masterRouter.HandleFunc("/vars.json", func(w http.ResponseWriter, r *http.Request) {
		w.WriteHeader(http.StatusOK)
		w.Header().Set("Content-Type", "application/json")
		json.NewEncoder(w).Encode(rawMetrics)
	})
	masterRouter.HandleFunc("/pendingtasks", func(w http.ResponseWriter, r *http.Request) {
		w.WriteHeader(http.StatusOK)
		w.Header().Set("Content-Type", "application/json")
		json.NewEncoder(w).Encode(rawMetrics)
	})
	masterRouter.HandleFunc("/leaderhealth", func(w http.ResponseWriter, r *http.Request) {
		w.WriteHeader(http.StatusOK)
		w.Header().Set("Content-Type", "application/json")
		json.NewEncoder(w).Encode(rawMetrics)
	})
	masterRouter.HandleFunc("/quotas", func(w http.ResponseWriter, r *http.Request) {
		w.WriteHeader(http.StatusOK)
		w.Header().Set("Content-Type", "application/json")
		json.NewEncoder(w).Encode(rawMetrics)
	})
	auroraTestServer = httptest.NewServer(masterRouter)

	rc := m.Run()
	auroraTestServer.Close()

	os.Exit(rc)
}

func TestAurora_Gather(t *testing.T) {
	var acc testutil.Accumulator
	acc.SetDebug(false)
	m := Aurora{
		Hosts: []string{"http://" + auroraTestServer.Listener.Addr().String()},
	}

	err := acc.GatherError(m.Gather)

	if err != nil {
		t.Errorf(err.Error())
	}
	assert.True(t, acc.HasMeasurement("aurora"), "`aurora` Measurement not found")
	assert.True(t, acc.HasMeasurement("aurora:cron"), "`aurora:cron` Measurement not found")
	assert.True(t, acc.HasMeasurement("aurora:job:update"), "`aurora:job:update` Measurement not found")
	assert.True(t, acc.HasMeasurement("aurora:jvm"), "`aurora:jvm` Measurement not found")
	assert.True(t, acc.HasMeasurement("aurora:jvm:threads"), "`aurora:jvm:threads` Measurement not found")
	assert.True(t, acc.HasMeasurement("aurora:log:storage:write"), "`aurora:log:storage:write` Measurement not found")
	assert.True(t, acc.HasMeasurement("aurora:schedule"), "`aurora:schedule` Measurement not found")
	assert.True(t, acc.HasMeasurement("aurora:scheduler"), "`aurora:scheduler` Measurement not found")
	assert.True(t, acc.HasMeasurement("aurora:scheduler:log"), "`aurora:scheduler:log` Measurement not found")
	assert.True(t, acc.HasMeasurement("aurora:scheduler:tasks"), "`aurora:scheduler:tasks` Measurement not found")
	assert.True(t, acc.HasMeasurement("aurora:scheduler:thrift"), "`aurora:scheduler:thrift` Measurement not found")
	assert.True(t, acc.HasMeasurement("aurora:scheduled_task"), "`aurora:scheduler:scheduled_task` Measurement not found")
	assert.True(t, acc.HasMeasurement("aurora:task"), "`aurora:task` Measurement not found")
	assert.True(t, acc.HasMeasurement("aurora:sla"), "`aurora:sla` Measurement not found")
	assert.True(t, acc.HasMeasurement("aurora:system"), "`aurora:system` Measurement not found")
	assert.True(t, acc.HasMeasurement("aurora:tasks"), "`aurora:tasks` Measurement not found")
	assert.True(t, acc.HasMeasurement("aurora:http:responses"), "`aurora:http:responses` Measurement not found")

}
